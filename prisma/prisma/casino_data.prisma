generator client {
    provider = "prisma-client-js"
    output   = "./generated/casino_data"
}

datasource db {
    provider = "postgres"
    url      = "postgres://postgres:Alibaba@1408@localhost:5433/casino_data"
}

model Admin {
    id          String          @id @default(uuid()) @db.Uuid
    email       String          @@unique @db.VarChar(30)
    password    String          @db.VarChar(100)
    name        String          @@unique @db.VarChar(30)
    token       String?         @db.VarChar(100)
    createdAt   DateTime        @default(now())
    updatedAt   DateTime?       @updatedAt
    accessToken String?         @db.VarChar(100)
    agent       Agent[]
    noticelist  NoticeList[]
    history     ActionHistory[] @relation("AdminActionHistory")
}

model Agent {
    id          String          @id @default(uuid()) @db.Uuid
    email       String          @unique @db.VarChar(30)
    password    String          @db.VarChar(100)
    name        String          @unique @db.VarChar(30)
    active      Boolean         @default(true)
    token       String?         @db.VarChar(100)
    quota       Int             @default(0)
    createdAt   DateTime        @default(now())
    updatedAt   DateTime?       @updatedAt
    accessToken String?         @db.VarChar(100)
    users       User[]
    adminId     String?         @db.Uuid
    createdBy   Admin?          @relation(fields: [adminId], references: [id])
    history     ActionHistory[] @relation("AgentActionHistory")

    @@unique([email], map: "agent_email")
    @@unique([name], map: "agent_name")
}

model User {
    id               String             @id @default(uuid()) @db.Uuid
    email            String             @unique @db.VarChar(30)
    username         String             @unique @db.VarChar(30)
    password         String             @db.VarChar(100)
    headImage        String             @db.VarChar(100)
    active           Boolean            @default(true)
    token            String?            @db.VarChar(100)
    createdAt        DateTime           @default(now())
    updatedAt        DateTime?          @updatedAt
    accessToken      String?            @db.VarChar(100)
    agentId          String?            @db.Uuid
    createdByAgent   Agent?             @relation(fields: [agentId], references: [id])
    balance          Balance[]
    betDetailHistory BetDetailHistory[]
    paymentHistory   PaymentHistory[]
    history          ActionHistory[]    @relation("UserActionHistory")

    @@unique([email], map: "user_email")
    @@unique([username], map: "user_name")
}

model ActionHistory {
    id           String   @id @default(uuid()) @db.Uuid
    type         Int
    newValueJson Json?
    ip           String   @db.VarChar(20)
    createdAt    DateTime @default(now())
    userId       String?  @db.Uuid
    agentId      String?  @db.Uuid
    adminId      String?  @db.Uuid
    user         User?    @relation("UserActionHistory", fields: [userId], references: [id])
    agent        Agent?   @relation("AgentActionHistory", fields: [agentId], references: [id])
    admin        Admin?   @relation("AdminActionHistory", fields: [adminId], references: [id])
}

model Balance {
    id        String    @id @default(uuid()) @db.Uuid
    balance   Int
    createdAt DateTime  @default(now())
    updatedAt DateTime? @updatedAt
    ownerId   String    @db.Uuid
    owner     User      @relation(fields: [ownerId], references: [id])
}

model GameList {
    id               Int                @id
    eGameName        String             @db.VarChar(100)
    cGameName        String             @db.VarChar(30)
    type             Int
    json             Json?
    createdAt        DateTime           @default(now())
    betDetailHistory BetDetailHistory[]
}

model PaymentHistory {
    id          String    @id @default(uuid()) @db.Uuid
    beforeScore Int
    changeScore Int
    newScore    Int
    approval    Boolean   @default(false)
    createdAt   DateTime  @default(now())
    approvalAt  DateTime? @updatedAt
    ownerId     String    @db.Uuid
    owner       User      @relation(fields: [ownerId], references: [id])
}

model BetDetailHistory {
    id          String    @id @default(uuid()) @db.Uuid
    beforeScore Int
    betScore    Int
    winScore    Int
    newScore    Int
    createAt    DateTime  @default(now())
    updateAt    DateTime? @updatedAt
    ownerId     String    @db.Uuid
    gameId      Int
    owner       User      @relation(fields: [ownerId], references: [id])
    gameList    GameList  @relation(fields: [gameId], references: [id])
}

model NoticeList {
    id        String    @id @default(uuid()) @db.Uuid
    status    Boolean   @default(false)
    txt       String    @db.VarChar(255)
    createdAt DateTime  @default(now())
    updateAt  DateTime? @updatedAt
    adminId   String    @db.Uuid
    createdBy Admin     @relation(fields: [adminId], references: [id])
}
